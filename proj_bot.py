import telebot
from bot_token import YLP_TOKEN
from copy import deepcopy
import random
import requests
import datetime
import threading

bot = telebot.TeleBot(YLP_TOKEN)

sad_words = ["–æ–¥–∏–Ω–æ–∫–æ", "–≥—Ä—É—Å—Ç–Ω–æ",
             "–Ω–µ–≤–µ—Å–µ–ª–æ", "–ø–µ—á–∞–ª—å–Ω–æ"]
sad_caption = ['–ó–Ω–∞–µ—à—å, –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ —Ç–µ–±–µ –≥—Ä—É—Å—Ç–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç—ã –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –∏–ª–∏ –Ω–µ—Ç –æ—Ç—Å—Ç—Ä–∞–Ω–∏–ª—Å—è –æ—Ç',
               '—Å–≤–æ–∏—Ö –±–ª–∏–∑–∫–∏—Ö –ª—é–¥–µ–π. –ü–æ–º–Ω–∏, —á—Ç–æ —É —Ç–µ–±—è –≤—Å–µ–≥–¥–∞ –±—É–¥—É—Ç —Ç–µ, –∫—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ –Ω–∞ –ø–æ–º–æ—â—å']
help_message = ['–í—Å—ë-—Ç–∞–∫–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å?\n',
                '–ß—Ç–æ –∂, –µ—Å–ª–∏ —Ç—ã –Ω–µ –ø–æ–Ω—è–ª, —Ç–æ —É —Ç–µ–±—è –µ—Å—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∏–∑ –∫–Ω–æ–ø–æ–∫, ',
                '–Ω–∞–∂–∞–≤ –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ, —Ç—ã —Å–º–æ–∂–µ—à—å –¥–æ–±–∏—Ç—å—Å—è –æ—Ç –º–µ–Ω—è –æ—Ç–≤–µ—Ç–∞.']

IDIOMS_LIST = ["ùóñùóøùóºùòÄùòÄ ùó∫ùòÜ ùóµùó≤ùóÆùóøùòÅ ùóÆùóªùó± ùóµùóºùóΩùó≤ ùòÅùóº ùó±ùó∂ùó≤(–æ–±–µ—â–∞—Ç—å,  –∫–ª—è—Å—Ç—å—Å—è)",
               "ùó†ùóÆùó∏ùó≤ ùóÆ ùó≥ùóºùóøùòÅùòÇùóªùó≤ (–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ —Ä–∞–∑–±–æ–≥–∞—Ç–µ—Ç—å, –ø—Ä–∏–ª–æ–∂–∏–≤ –∫ —ç—Ç–æ–º—É –º–∏–Ω–∏–º—É–º —É—Å–∏–ª–∏–π)",
               "ùó¶ùóΩùó≤ùóÆùó∏ ùóºùó≥ ùòÅùóµùó≤ ùó±ùó≤ùòÉùó∂ùóπ (–ª–µ–≥–æ–∫ –Ω–∞ –ø–æ–º–∏–Ω–µ, –ø–æ–º—è–Ω–∏ —á–µ—Ä—Ç–∞, –æ–Ω –∏ –ø–æ—è–≤–∏—Ç—Å—è)",
               "ùóúùó≥ ùòÜùóºùòÇ'ùóπùóπ ùóΩùóÆùóøùó±ùóºùóª ùó∫ùòÜ ùóôùóøùó≤ùóªùó∞ùóµ (–ü—Ä–æ—Å—Ç–∏—Ç–µ –º–æ–π —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π/–º–µ–Ω—è –∑–∞ –º–æ–π —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π)",
               "ùóïùóøùó≤ùóÆùó∏ ùóÆ ùóπùó≤ùó¥ (–£–¥–∞—á–∏!)",
               "ùóùùóÆùó∞ùó∏ ùóºùó≥ ùóÆùóπùóπ ùòÅùóøùóÆùó±ùó≤ùòÄ (–º–∞—Å—Ç–µ—Ä –Ω–∞ –≤—Å–µ —Ä—É–∫–∏)",
               "ùóîùóªùó± ùóÆùóπùóπ ùòÅùóµùóÆùòÅ ùó∑ùóÆùòáùòá (–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ, –∏ —Ç–æ–º—É –ø–æ–¥–æ–±–Ω–æ–µ)",
               "ùóüùóºùòÄùó≤ ùòÜùóºùòÇùóø ùòÅùóºùòÇùó∞ùóµ (–ø–æ—Ç–µ—Ä—è—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å/—Ç–∞–ª–∞–Ω—Ç –∫ —á–µ–º—É-—Ç–æ)",
               "ùóüùó≤ùòÅ ùòÄùóπùó≤ùó≤ùóΩùó∂ùóªùó¥ ùó±ùóºùó¥ùòÄ ùóπùó∂ùó≤ (–Ω–µ –Ω–∞–¥–æ –¥–µ—Ä–≥–∞—Ç—å —Ç–∏–≥—Ä–∞ –∑–∞ —É—Å—ã, –ª—É—á—à–µ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —è—â–∏–∫ –ü–∞–Ω–¥–æ—Ä—ã)",
               "ùó†ùóºùóªùó∏ùó≤ùòÜ ùóØùòÇùòÄùó∂ùóªùó≤ùòÄùòÄ (–≤–∞–ª—è–Ω–∏–µ –¥—É—Ä–∞–∫–∞, —Ä–∞–∑–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –Ω–∞ –º–µ–ª–æ—á–∏)",
               "ùóùùòÇùó∫ùóΩ ùóºùóª ùòÅùóµùó≤ ùóØùóÆùóªùó±ùòÑùóÆùó¥ùóºùóª (–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–∞–∫–æ–º—É-—Ç–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ–º—É –¥–≤–∏–∂–µ–Ω–∏—é —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ —Ç–∞–∫ –¥–µ–ª–∞—é—Ç –¥—Ä—É–≥–∏–µ)",
               "ùóñùòÇùòÅ ùó∞ùóºùóøùóªùó≤ùóøùòÄ (c–¥–µ–ª–∞—Ç—å —á—Ç–æ-—Ç–æ —Å–∞–º—ã–º –ª–µ–≥–∫–∏–º, –¥–µ—à–µ–≤—ã–º –∏–ª–∏ –±—ã—Å—Ç—Ä—ã–º –ø—É—Ç–µ–º (–∏–Ω–æ–≥–¥–∞, –≤ —É—â–µ—Ä–± –∫–∞—á–µ—Å—Ç–≤—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞), –∫–æ–µ-–∫–∞–∫)"]

EXAMPLES_LIST = [
    "ùêº ùëëùëñùëë ùëôùëúùëêùëò ùë°‚Ñéùëí ùëëùëúùëúùëü ‚Äî ùëêùëüùëúùë†ùë† ùëöùë¶ ‚Ñéùëíùëéùëüùë° ùëéùëõùëë ‚Ñéùëúùëùùëí ùë°ùëú ùëëùëñùëí! (–Ø –ø—Ä–∞–≤–¥–∞ –∑–∞–∫—Ä—ã–≤–∞–ª –¥–≤–µ—Ä—å, –∫–ª—è–Ω—É—Å—å!)",
    'ùëäùëéùëüùëüùëíùëõ ùêµùë¢ùëìùëìùëíùë°ùë° ‚Ñéùëéùë† ùëöùëéùëëùëí ùëé ùëìùëúùëüùë°ùë¢ùëõùëí ùëúùëìùëì ùê¥ùëùùëùùëôùëí ‚Äî ‚Ñéùëíùëüùëí‚Äôùë† ùë°‚Ñéùëí ùë†ùëñùëöùëùùëôùëí ùëüùëíùëéùë†ùëúùëõ ‚Ñéùëí ùëñùëõùë£ùëíùë†ùë°ùëíùëë ùëñùëõ ùëñùë°. (–£–æ—Ä—Ä–µ–Ω –ë–∞—Ñ—Ñ–µ—Ç —Å–æ—Ä–≤–∞–ª –∫—É—à –Ω–∞ Apple, –≤–æ—Ç –ø—Ä–æ—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞ —Ç–æ–≥–æ, —á—Ç–æ –æ–Ω –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –≤ —ç—Ç—É –∫–æ–º–ø–∞–Ω–∏—é.)',
    'ùê∑ùëñùëë ùë¶ùëúùë¢ ‚Ñéùëíùëéùëü ùë§‚Ñéùëéùë° ‚Ñéùëéùëùùëùùëíùëõùëíùëë ùë°ùëú ùëÄùëéùëüùë¶ ùë°ùëúùëëùëéùë¶? ùëÇ‚Ñé, ùë†ùëùùëíùëéùëò ùëúùëì ùë°‚Ñéùëí ùëëùëíùë£ùëñùëô, ùë°‚Ñéùëíùëüùëí ùë†‚Ñéùëí ùëñùë†. (–¢—ã —Å–ª—ã—à–∞–ª, —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è –ø—Ä–æ–∏–∑–æ—à–ª–æ —Å –ú—ç—Ä–∏? –û, –≤–æ—Ç –∏ –æ–Ω–∞ —Å–∞–º–∞, –ª–µ–≥–∫–∞ –Ω–∞ –ø–æ–º–∏–Ω–µ.)',
    'ùê¥ùëüùëí ùë¶ùëúùë¢ ùëòùëñùëëùëëùëñùëõùëî ùëöùëí? ùëá‚Ñéùëéùë°‚Äôùë† ‚Ñéùëúùëüùë†ùëíùë†‚Ñéùëñùë°, ùëñùëì ùë¶ùëúùë¢‚Äôùëôùëô ùëùùëéùëüùëëùëúùëõ ùëöùë¶ ùêπùëüùëíùëõùëê‚Ñé! (–®—É—Ç–∏—à—å? –ü—Ä–æ—Å—Ç–∏, –∫–æ–Ω–µ—á–Ω–æ, –∑–∞ –º–æ–π —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π, –Ω–æ —ç—Ç–æ —á—É—à—å —Å–æ–±–∞—á—å—è.)',
    "ùêªùëéùë£ùëíùëõ‚Äôùë° ùêº ùë°ùëúùëôùëë ùë¶ùëúùë¢ ùë°‚Ñéùëéùë° ùêº'ùëö ùëîùëúùëñùëõùëî ùë°ùëú ùëûùë¢ùëñùë° ùë†ùëöùëúùëòùëñùëõùëî? (–†–∞–∑–≤–µ —è –Ω–µ –≥–æ–≤–æ—Ä–∏–ª, —á—Ç–æ –±—Ä–æ—Å–∞—é –∫—É—Ä–∏—Ç—å?) ‚Äî ùëÇ‚Ñé, ùë§ùëúùë§, ùëèùëüùëíùëéùëò ùëé ùëôùëíùëî! (–û–≥–æ, —É–¥–∞—á–∏!)",
    'ùêº ùëéùëö ùë£ùëíùëüùë¶ ùëîùëôùëéùëë ùë°‚Ñéùëéùë° ùëöùë¶ ‚Ñéùë¢ùë†ùëèùëéùëõùëë ùëñùë† ùëé ùêΩùëéùëêùëò ùëúùëì ùëéùëôùëô ùë°ùëüùëéùëëùëíùë†; ùëñùë° ùë†ùëéùë£ùëíùëë ùë¢ùë† ùëé ùëôùëúùë° ùëúùëì ùëöùëúùëõùëíùë¶ ùë§‚Ñéùëíùëõ ùëñùë° ùëêùëéùëöùëí ùë°ùëú ùëüùëíùëõùëúùë£ùëéùë°ùëñùëõùëî ùëúùë¢ùëü ‚Ñéùëúùë¢ùë†ùëí. (¬´–Ø –æ—á–µ–Ω—å —Ä–∞–¥–∞, —á—Ç–æ –º–æ–π –º—É–∂ ‚Äî –º–∞—Å—Ç–µ—Ä –Ω–∞ –≤—Å–µ —Ä—É–∫–∏. –≠—Ç–æ –ø–æ–º–æ–≥–ª–æ –Ω–∞–º —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –º–Ω–æ–≥–æ –¥–µ–Ω–µ–≥ –ø—Ä–∏ —Ä–µ–º–æ–Ω—Ç–µ –¥–æ–º–∞¬ª.)',
    'ùëÄùë¶ ùê∏ùëõùëîùëôùëñùë†‚Ñé ùë°ùëíùëéùëê‚Ñéùëíùëü ùëñùë† ùë†ùëöùëéùëüùë° ùëéùëõùëë ùëòùëñùëõùëë, ùë°ùëúùëôùëíùëüùëéùëõùë° ùëéùëõùëë ùë†ùëíùëêùë¢ùëüùëí, ùëùùëéùë°ùëñùëíùëõùë° ùëéùëõùëë ùëéùëôùëô ùë°‚Ñéùëéùë° ùëóùëéùëßùëß. (–ú–æ–π —É—á–∏—Ç–µ–ª—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —É–º–Ω—ã–π –∏ –¥–æ–±—Ä—ã–π, —Å–ø–æ–∫–æ–π–Ω—ã–π –∏ —É–≤–µ—Ä–µ–Ω–Ω—ã–π, —Ç–µ—Ä–ø–µ–ª–∏–≤—ã–π –∏ –≤—Å–µ —Ç–∞–∫–æ–µ.)',
    "ùêªùëí ùë¢ùë†ùëíùëë ùë°ùëú ùëèùëí ùëé ùëîùëúùëúùëë ùëñùëôùëôùë¢ùë†ùë°ùëüùëéùë°ùëúùëü, ùëèùë¢ùë° ùêº ùë°‚Ñéùëñùëõùëò ‚Ñéùëí'ùë† ùëôùëúùë†ùëñùëõùëî ‚Ñéùëñùë† ùë°ùëúùë¢ùëê‚Ñé. (–†–∞–Ω—å—à–µ –æ–Ω –±—ã–ª —Ö–æ—Ä–æ—à–∏–º –∏–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º, –Ω–æ, –¥—É–º–∞—é, –æ–Ω —Ä–∞—Å—Ç–µ—Ä—è–ª —Å–≤–æ–π —Ç–∞–ª–∞–Ω—Ç.)",
    'ùëÜ‚Ñéùëúùë¢ùëôùëë ùêº ùë†ùë°ùëéùëüùë° ùë§ùëéùë°ùëê‚Ñéùëñùëõùëî ùê∫ùëéùëöùëí ùëúùëì ùëá‚Ñéùëüùëúùëõùëíùë† ùëúùëü ùëóùë¢ùë†ùë° ùëôùëíùë° ùë†ùëôùëíùëíùëùùëñùëõùëî ùëëùëúùëîùë† ùëôùëñùëí? (–ú–Ω–µ –Ω–∞—á–∞—Ç—å —Å–º–æ—Ç—Ä–µ—Ç—å "–ò–≥—Ä—É –ø—Ä–µ—Å—Ç–æ–ª–æ–≤", –∏–ª–∏ –ª—É—á—à–µ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —è—â–∏–∫ –ü–∞–Ω–¥–æ—Ä—ã?',
    "ùêº ùëëùëúùëõ'ùë° ‚Ñéùëéùë£ùëí ùëõùëú ùë°ùëñùëöùëí ùëìùëúùëü ùëõùëú ùëöùëúùëõùëòùëíùë¶ ùëèùë¢ùë†ùëñùëõùëíùë†ùë†. (–ú–Ω–µ –Ω–µ–∫–æ–≥–¥–∞ —Ä–∞–∑–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –Ω–∞ –º–µ–ª–æ—á–∏.)",
    "ùëåùëíùëé‚Ñé, ùêº'ùëö ùëóùë¢ùëöùëùùëñùëõùëî ùëúùëõ ùë°‚Ñéùëí ùëèùëéùëõùëëùë§ùëéùëîùëúùëõ ùë°‚Ñéùëñùë† ùë¶ùëíùëéùëü ùëéùëõùëë ùëöùëéùëòùëñùëõùëî ùëé ùêµùëíùë†ùë° ùëúùëì 2023 ùë£ùëñùëëùëíùëú ùëúùëõ ùëåùëúùë¢ùë°ùë¢ùëèùëí. (–î–∞, –≤ —ç—Ç–æ–º –≥–æ–¥—É —è –ø–æ–¥–¥–∞–º—Å—è –ø–æ–ø—É–ª—è—Ä–Ω—ã–º —Ç–µ–Ω–¥–µ–Ω—Ü–∏—è–º –∏ –≤—ã–ª–æ–∂—É –Ω–∞ —é—Ç—É–± –≤–∏–¥–µ–æ ¬´–õ—É—á—à–µ–µ –∑–∞ 2023¬ª.)",
    'ùëá‚Ñéùëíùëüùëí ùëñùë† ùëéùëôùë§ùëéùë¶ùë† ùëé ùë°ùëíùëöùëùùë°ùëéùë°ùëñùëúùëõ ùë°ùëú ùëêùë¢ùë° ùëêùëúùëüùëõùëíùëüùë† ùë§‚Ñéùëíùëõ ùë°ùëñùëöùëí ùëñùë† ùë†‚Ñéùëúùëüùë°. (–í—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Å–æ–±–ª–∞–∑–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–µ-–∫–∞–∫, –∫–æ–≥–¥–∞ –≤—Ä–µ–º–µ–Ω–∏ –º–∞–ª–æ.)']

test = {"ùóñùóøùóºùòÄùòÄ ùó∫ùòÜ ùóµùó≤ùóÆùóøùòÅ ùóÆùóªùó± ùóµùóºùóΩùó≤ ùòÅùóº ùó±ùó∂ùó≤": "–æ–±–µ—â–∞—Ç—å,  –∫–ª—è—Å—Ç—å—Å—è",
        "ùó†ùóÆùó∏ùó≤ ùóÆ ùó≥ùóºùóøùòÅùòÇùóªùó≤": "—Ä–∞–∑–±–æ–≥–∞—Ç–µ—Ç—å c –º–∏–Ω–∏–º—É–º–æ–º —É—Å–∏–ª–∏–π",
        "ùó¶ùóΩùó≤ùóÆùó∏ ùóºùó≥ ùòÅùóµùó≤ ùó±ùó≤ùòÉùó∂ùóπ": "–ª–µ–≥–æ–∫ –Ω–∞ –ø–æ–º–∏–Ω–µ",
        "ùóúùó≥ ùòÜùóºùòÇ'ùóπùóπ ùóΩùóÆùóøùó±ùóºùóª ùó∫ùòÜ ùóôùóøùó≤ùóªùó∞ùóµ": "–ü—Ä–æ—Å—Ç–∏—Ç–µ –º–µ–Ω—è –∑–∞ –º–æ–π —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π",
        "ùóïùóøùó≤ùóÆùó∏ ùóÆ ùóπùó≤ùó¥": "–£–¥–∞—á–∏!",
        "ùóùùóÆùó∞ùó∏ ùóºùó≥ ùóÆùóπùóπ ùòÅùóøùóÆùó±ùó≤ùòÄ": "–º–∞—Å—Ç–µ—Ä –Ω–∞ –≤—Å–µ —Ä—É–∫–∏",
        "ùóîùóªùó± ùóÆùóπùóπ ùòÅùóµùóÆùòÅ ùó∑ùóÆùòáùòá": "–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ, –∏ —Ç–æ–º—É –ø–æ–¥–æ–±–Ω–æ–µ",
        "ùóüùóºùòÄùó≤ ùòÜùóºùòÇùóø ùòÅùóºùòÇùó∞ùóµ": "–ø–æ—Ç–µ—Ä—è—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ —á–µ–º—É-—Ç–æ",
        "ùóüùó≤ùòÅ ùòÄùóπùó≤ùó≤ùóΩùó∂ùóªùó¥ ùó±ùóºùó¥ùòÄ ùóπùó∂ùó≤": "–Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —è—â–∏–∫ –ü–∞–Ω–¥–æ—Ä—ã",
        "ùó†ùóºùóªùó∏ùó≤ùòÜ ùóØùòÇùòÄùó∂ùóªùó≤ùòÄùòÄ": "–≤–∞–ª—è–Ω–∏–µ –¥—É—Ä–∞–∫–∞",
        "ùóùùòÇùó∫ùóΩ ùóºùóª ùòÅùóµùó≤ ùóØùóÆùóªùó±ùòÑùóÆùó¥ùóºùóª": "–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –ø–æ–ø –¥–≤–∏–∂–µ–Ω–∏—é",
        "ùóñùòÇùòÅ ùó∞ùóºùóøùóªùó≤ùóøùòÄ": "c–¥–µ–ª–∞—Ç—å —á—Ç–æ-—Ç–æ —Å–∞–º—ã–º –ª–µ–≥–∫–∏–º –ø—É—Ç–µ–º"}

SKOLKO_IDIOM = len(IDIOMS_LIST)
SKOLKO_EXAMPLE = SKOLKO_IDIOM

game_started = False

chosen_quest = ''
r_ans = ''


def current_weather(lat, lon):
    url = f'https://api.open-meteo.com/v1/forecast?latitude={lat}&longitude={lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,rain,showers,snowfall,weather_code,wind_speed_10m,wind_direction_10m&wind_speed_unit=ms&timezone=Europe%2FMoscow'
    r = requests.get(url).json()['current']
    ans = f"–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {r['temperature_2m']} ¬∞C\n–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞: {r['wind_speed_10m']} –º/—Å\n"
    lst = ['–°', 'CB', 'B', '–Æ–í', '–Æ', '–Æ–ó', '–ó', "–°–ó"]
    win_dir = lst[r['wind_direction_10m'] % 360 // 45]
    ans += f'–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ç—Ä–∞: {win_dir}'
    w_code = {
        0: "–Ø—Å–Ω–æ–µ –Ω–µ–±–æ",
        1: "–í –æ—Å–Ω–æ–≤–Ω–æ–º —è—Å–Ω–æ",
        2: '–ß–∞—Å—Ç–∏—á–Ω–æ –æ–±–ª–∞—á–Ω–æ',
        3: '–ü–∞—Å–º—É—Ä–Ω–æ',
        45: "–¢—É–º–∞–Ω",
        48: '–æ—Å–∞–∂–¥–∞—é—â–∏–π –∏–Ω–µ–π, —Ç—É–º–∞–Ω',
        51: '–õ–µ–≥–∫–∏–π –º–æ—Ä–æ—Å—è—â–∏–π –¥–æ–∂–¥—å',
        53: '–£–º–µ—Ä–µ–Ω–Ω—ã–π –º–æ—Ä–æ—Å—è—â–∏–π –¥–æ–∂–¥—å',
        55: '–ú–æ—Ä–æ—Å—è—â–∏–π –¥–æ–∂–¥—å –≥—É—Å—Ç–æ–π –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏',
        56: 'M–æ—Ä–æ—Å—è—â–∏–π –º–µ–ª–∫–∏–π –¥–æ–∂–¥–∏–∫',
        57: '–ú–æ—Ä–æ—Å—è—â–∏–π –≥—É—Å—Ç–æ–π –∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π –¥–æ–∂–¥—å',
        61: '–ù–µ–±–æ–ª—å—à–æ–π –¥–æ–∂–¥—å',
        63: '–î–æ–∂–¥—å —É–º–µ—Ä–µ–Ω–Ω—ã–π',
        65: '–î–æ–∂–¥—å —Å–∏–ª—å–Ω–æ–π –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏',
        66: '–ú–µ–ª–∫–∏–π –ª–µ–¥—è–Ω–æ–π –¥–æ–∂–¥—å',
        67: "–õ–µ–¥—è–Ω–æ–π —Å–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å",
        71: '–ù–µ–±–æ–ª—å—à–æ–π —Å–Ω–µ–≥–æ–ø–∞–¥',
        73: '–£–º–µ—Ä–µ–Ω–Ω—ã–π —Å–Ω–µ–≥–æ–ø–∞–¥',
        75: '–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥–æ–ø–∞–¥',
        77: '–°–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞',
        80: '–ù–µ–±–æ–ª—å—à–æ–π –ª–∏–≤–µ–Ω—å',
        81: '–£–º–µ—Ä–µ–Ω–Ω—ã–π –ª–∏–≤–µ–Ω—å',
        82: '–°–∏–ª—å–Ω—ã–µ –ª–∏–≤–Ω–µ–≤—ã–µ –¥–æ–∂–¥–∏',
        85: '–ù–µ–±–æ–ª—å—à–æ–π —Å–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥–æ–ø–∞–¥',
        86: '–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥–æ–ø–∞–¥',
        95: '–ù–µ–±–æ–ª—å—à–∞—è –≥—Ä–æ–∑–∞',
        96: '–ì—Ä–æ–∑–∞ —Å –Ω–µ–±–æ–ª—å—à–∏–º –≥—Ä–∞–¥–æ–º',
        99: '–ì—Ä–æ–∑–∞ —Å —Å–∏–ª—å–Ω—ã–º –≥—Ä–∞–¥–æ–º'
    }
    weather_status = w_code[r['weather_code']]
    ans += f'\n–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–≥–æ–¥—ã: {weather_status}'
    return ans


lat = '52.52'
lon = '13.41'


def start_menu():
    keyboard = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True)
    button = telebot.types.KeyboardButton(text='–°–ª—É—á–∞–π–Ω—ã–π –∞–Ω–µ–∫–¥–æ—Ç')
    keyboard.add(button)


users_info = {}  # –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∏–≥—Ä–æ–∫–µ

joke = {"programming": [
    '–£ –º–µ–Ω—è –±—ã–ª–∞ –æ–¥–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞, –ø–æ—ç—Ç–æ–º—É —è —Ä–µ—à–∏–ª –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É, –∫–æ—Ç–æ—Ä–∞—è –µ—ë —Ä–µ—à–∏—Ç. –¢–µ–ø–µ—Ä—å —É –º–µ–Ω—è –µ—Å—Ç—å 1 –ø—Ä–æ–±–ª–µ–º–∞, 9 –æ—à–∏–±–æ–∫ –∏ 12 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π.',
    '–ï—Å–ª–∏ –±—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –±—ã–ª–∏ –≤—Ä–∞—á–∞–º–∏, –∏–º –±—ã –≥–æ–≤–æ—Ä–∏–ª–∏ ¬´–£ –º–µ–Ω—è –±–æ–ª–∏—Ç –Ω–æ–≥–∞¬ª, –∞ –æ–Ω–∏ –æ—Ç–≤–µ—á–∞–ª–∏ ¬´–ù—É –Ω–µ –∑–Ω–∞—é, —É –º–µ–Ω—è —Ç–∞–∫–∞—è –∂–µ –Ω–æ–≥–∞, –∞ –Ω–∏—á–µ–≥–æ –Ω–µ –±–æ–ª–∏—Ç¬ª',
    '–•–æ—Ä–æ—à–∏–π –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –ø—Ä–æ–ª–∏–≤–∞–µ—Ç –∫–æ—Ñ–µ –Ω–∞ —Å–µ–±—è. –ò –Ω–æ—É—Ç —Ü–µ–ª, –∏ –±–æ–¥—Ä–∏—Ç –≤ –¥–≤–∞ —Ä–∞–∑–∞ –ª—É—á—à–µ.',
    '–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π, –µ—Å–ª–∏ –Ω–µ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞–¥–æ. –ï—Å–ª–∏ –±—ã –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ —Ö–æ—Ä–æ—à–æ, —Ç–æ —Ç—ã –±—ã –∑–¥–µ—Å—å –¥–∞–≤–Ω–æ —É–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª.',
    '–ë–∞–≥ ‚Äî —ç—Ç–æ –µ—â–µ –Ω–µ –∑–∞–ø–∏—Å–∞–Ω–Ω–∞—è  —Ñ–∏—á–∞.',
    '–û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –±–∞–≥–∏, –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ.'
],
    'gamers': [
        '–î–µ–≤—É—à–∫–∏! –ï—Å–ª–∏ –ø–∞—Ä–µ–Ω—å –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ–∏–≥—Ä—É, —á—Ç–æ–±—ã –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, ‚Äî –≤—ã—Ö–æ–¥–∏—Ç–µ –∑–∞ –Ω–µ–≥–æ –∑–∞–º—É–∂!',
        '–°–µ–π—á–∞—Å –Ω—É–∂–Ω–æ –æ—á–µ–Ω—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –¥–æ—Ä–æ–≥—É, —Ç–∞–∫ –∫–∞–∫ –¥–µ—Ç–∏, –≤—ã—Ä–æ—Å—à–∏–µ –Ω–∞ GTA, Carmageddon –∏ Need For Speed, –Ω–∞—á–∞–ª–∏ –ø–æ–ª—É—á–∞—Ç—å –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–∞–≤–∞.',
        '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –µ—Å–ª–∏ —è –ø—Ä–æ–¥–∞–º –∞–∫–∫–∞—É–Ω—Ç —Å—ã–Ω–∞ –∏ –º—É–∂–∞ –≤ ¬´–¢–∞–Ω–∫–∞—Ö¬ª –∏ –∫—É–ø–ª—é —Å–µ–±–µ –ø—É—Ç–µ–≤–∫—É –Ω–∞ –º–æ—Ä–µ, —è –¥–æ –≤–æ–∫–∑–∞–ª–∞ –¥–æ–µ—Ö–∞—Ç—å —É—Å–ø–µ—é?',
        '–ï—Å–ª–∏ —Ç–∞–∫ –ø–æ–¥—É–º–∞—Ç—å, —Ç–æ, –∫–æ–≥–¥–∞ —Ç—ã —Ç—Ä–∞—Ç–∏—à—å –¥–µ–Ω—å–≥–∏ –Ω–∞ —à–º–æ—Ç–∫–∏ –∏ –ø—Ä–æ—á–∏–µ –±–æ–Ω—É—Å—ã –≤ –∏–≥—Ä–∞—Ö, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–µ–µ –ø–æ–±–µ–¥–∏—Ç—å, —Ç—ã, –ø–æ —Å—É—Ç–∏, –ø–ª–∞—Ç–∏—à—å –∑–∞ —Ç–æ, —á—Ç–æ–±—ã –º–µ–Ω—å—à–µ –∏–≥—Ä–∞—Ç—å.üôÅ',
        '‚Äî –ö–∞–∫–æ–π —É —Ç–µ–±—è —É—Ä–æ–≤–µ–Ω—å IQ? \n‚Äî –Ø –Ω–µ –∏–≥—Ä–∞–ª –≤ —ç—Ç—É –∏–≥—Ä—É.',
    ],
    'stirlitz': [
        '–®—Ç–∏—Ä–ª–∏—Ü –∏–≥—Ä–∞–ª –≤ –∫–∞—Ä—Ç—ã –∏ –ø—Ä–æ–∏–≥—Ä–∞–ª—Å—è. –ù–æ –®—Ç–∏—Ä–ª–∏—Ü —É–º–µ–ª –¥–µ–ª–∞—Ç—å —Ö–æ—Ä–æ—à—É—é –º–∏–Ω—É –ø—Ä–∏ –ø–ª–æ—Ö–æ–π –∏–≥—Ä–µ. –ö–æ–≥–¥–∞ –®—Ç–∏—Ä–ª–∏—Ü –ø–æ–∫–∏–Ω—É–ª –∫–æ–º–ø–∞–Ω–∏—é, –º–∏–Ω–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∞.',
        '–®—Ç–∏—Ä–ª–∏—Ü—É –ø–æ–ø–∞–ª–∞ –≤ –≥–æ–ª–æ–≤—É –ø—É–ª—è. "–†–∞–∑—Ä—ã–≤–Ω–∞—è," - —Ä–∞—Å–∫–∏–Ω—É–ª –º–æ–∑–≥–∞–º–∏ –®—Ç–∏—Ä–ª–∏—Ü.',
        '–®—Ç–∏—Ä–ª–∏—Ü –¥–æ–ª–≥–æ —Å–º–æ—Ç—Ä–µ–ª –≤ –æ–¥–Ω—É —Ç–æ—á–∫—É. –ü–æ—Ç–æ–º –≤ –¥—Ä—É–≥—É—é. "–î–≤–æ–µ—Ç–æ—á–∏–µ!" - –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ —Å–º–µ–∫–Ω—É–ª –®—Ç–∏—Ä–ª–∏—Ü.',
        '–ü–∏—Å—å–º–æ –∏–∑ —Ü–µ–Ω—Ç—Ä–∞ –¥–æ –®—Ç–∏p–ª–∏—Ü–∞ –Ω–µ –¥–æ—à–ª–æ... –ü—Ä–∏—à–ª–æ—Å—å —á–∏—Ç–∞—Ç—å –≤–æ –≤—Ç–æ—Ä–æ–π —Ä–∞–∑.']
}

locations = {
    '1': {'text': '–í—ã –∏–≥—Ä–∞–µ—Ç–µ –∑–∞ –≥–µ—Ä–æ—è, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ø–∞–ª –≤ –æ–ø–∞—Å–Ω—ã–π –ª–µ—Å. –í–∞–º –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å—Å—è –∂–∏–≤—ã–º.',
          'items': [],
          'next_move': {'–ü–æ–π—Ç–∏ –≤–ø–µ—Ä–µ–¥': '2'},
          'exchange': {}},
    '2': {'text': '–í—ã –ø–æ–ø–∞–ª–∏ –≤ —Å–∞–º—É—é —á–∞—â—É –ª–µ—Å–∞. –¢—É—Ç –æ—á–µ–Ω—å —Ç–∏—Ö–æ.',
          'items': [],
          'next_move': {'–ü–æ–π—Ç–∏ –Ω–∞–ª–µ–≤–æ': '3', '–ü–æ–π—Ç–∏ –ø—Ä—è–º–æ': '4', '–ü–æ–π—Ç–∏ –Ω–∞–ø—Ä–∞–≤–æ': '5'},
          'exchange': {}},
    '3': {
        'text': '–í—ã –∑–∞–±—Ä–µ–ª–∏ –≤ —Å–∞–º—É—é —Ç–µ–º–Ω—É—é –∏ –∑–ª–æ–≤–µ—â—É—é —á–∞—Å—Ç—å –ª–µ—Å–∞. –í —Ç–µ–º–Ω–æ—Ç–µ –≤—ã –Ω–µ –∑–∞–º–µ—Ç–∏–ª–∏ –º–∞–ª–µ–Ω—å–∫—É—é —è–¥–æ–≤–∏—Ç—É—é –∑–º–µ—é. –í–∞—Å —É–∫—É—Å–∏–ª–∏. –í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å –∫ –ø—Ä–∞–æ—Ç—Ü–∞–º.\n(–º–æ–∂–µ—à—å –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –≤ –º–æ—ë–º –ø—Ä–µ–¥—ã–¥—É—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –∏ –∫–∞–∫ –±—É–¥—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –±—ã–ª–æüòä)',
        'items': [],
        'next_move': {},
        'exchange': {}},
    '4': {
        'text': '–í—ã –≤—ã—à–ª–∏ –Ω–∞ –ø–æ–ª–µ. –ü–µ—Ä–µ–¥ –≤–∞–º–∏ —Å—Ç–æ–∏—Ç —Ç–æ—Ä–≥–æ–≤–µ—Ü. –û–Ω –ø—Ä–µ–¥–ª–æ–∂–∏–ª –≤–∞–º 3 –∑–æ–ª–æ—Ç—ã—Ö –º–æ–Ω–µ—Ç –∑–∞ —à–∫–∞—Ç—É–ª–∫—É. –û–¥–Ω–∞–∫–æ —É –≤–∞—Å –µ—ë –Ω–µ—Ç',
        'items': [],
        'next_move': {'–í–µ—Ä–Ω—É—Ç—å—Å—è –æ–±—Ä–∞—Ç–Ω–æ': '2'},
        'exchange': {'—à–∫–∞—Ç—É–ª–∫–∞': '–∑–æ–ª–æ—Ç–æ: 3'}},
    '5': {'text': '–í—ã –æ–∫–∞–∑–∞–ª–∏—Å—å –æ–∫–æ–ª–æ –∑–ª–æ–≤–µ—â–µ–≥–æ –ø–æ–¥–∑–µ–º–µ–ª—å—è.',
          'items': [],
          'next_move': {'–ü–æ–π—Ç–∏ –Ω–∞–∑–∞–¥': '2', '–ü–æ–π—Ç–∏ –≤–Ω—É—Ç—Ä—å': '7', '–û—Å–º–æ—Ç—Ä–µ—Ç—å—Å—è –≤–æ–∫—Ä—É–≥': '6'},
          'exchange': {}},
    '6': {
        'text': '–í—ã –±—Ä–æ–¥–∏—Ç–µ —Ä—è–¥–æ–º —Å –ø–µ—â–µ—Ä–æ–π –≤ –Ω–∞–¥–µ–∂–¥–µ –Ω–∞–π—Ç–∏ —á—Ç–æ-—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ...–ò –≤–∞–º —É–ª—ã–±–∞–µ—Ç—Å—è —É–¥–∞—á–∞: –≤—ã –Ω–∞—à–ª–∏ —à–∫–∞—Ç—É–ª–∫—É!',
        'items': ['—à–∫–∞—Ç—É–ª–∫–∞'],
        'next_move': {'–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–¥–∑–µ–º–µ–ª—å—é': '5'},
        'exchange': {}},
    '7': {
        'text': '–°—Ç–µ–Ω—ã –∑–¥–µ—Å—å –∏–∑ –≥—Ä—É–±–æ–≥–æ –∫–∞–º–Ω—è –∏ –ø–æ–∫—Ä—ã—Ç—ã –º—Ö–æ–º –∏ –ø–ª–µ—Å–µ–Ω—å—é. –í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –∑–∞–ø–∞—Ö —Å—ã—Ä–æ—Å—Ç–∏ –∏ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞.\n–û–ø—É—Å—Ç–∏–≤ –≥–ª–∞–∑–∞ –Ω–∞ –ø–æ–ª, –≤—ã —É–≤–∏–¥–µ–ª–∏ 2 –∑–æ–ª–æ—Ç—ã–µ –º–æ–Ω–µ—Ç—ã, –ª–µ–∂–∞—â–∏–µ –≤ —É–≥–ª—É –ø–æ–¥ –ø–æ—Ç—É—Ö—à–∏–º —Ñ–∞–∫–µ–ª–æ–º. –†–∞–∑—É–º–µ–µ—Ç—Å—è, –≤—ã –Ω–µ –ø—Ä–æ—à–ª–∏ –º–∏–º–æ –Ω–∏—Ö.',
        'items': ['–∑–æ–ª–æ—Ç–æ: 2'],
        'next_move': {'–ü–æ–π—Ç–∏ –≤–ø–µ—Ä–µ–¥': '8', '–í—ã–π—Ç–∏ –Ω–∞ —É–ª–∏—Ü—É': '5'},
        'exchange': {}},
    '8': {'text': '–í—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ –¥–∞–ª—å—à–µ. –¢—É—Ç –æ—á–µ–Ω—å —Ç–µ–º–Ω–æ, –Ω–æ –≤–¥—Ä—É–≥ –≤—ã –∑–∞–º–µ—á–∞–µ—Ç–µ —Å–≤–µ—Ç...',
          'items': [],
          'next_move': {'–ü–æ–π—Ç–∏ –¥–∞–ª—å—à–µ': '9', '–í–µ—Ä–Ω—É—Ç—å—Å—è': '7'},
          'exchange': {}},
    '9': {'text': '–í—ã—Ö–æ–¥ —É–∂–µ –±–ª–∏–∑–∫–æ, –Ω–æ –ø—Ä–∏–¥–µ—Ç—Å—è –∑–∞–ø–ª–∞—Ç–∏—Ç—å.',
          'items': [],
          'next_move': {'–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥': '8'},
          'exchange': {'–∑–æ–ª–æ—Ç–æ: 5': '–≤—ã—Ö–æ–¥'}}
}


def generate_story(user, position, call=None):
    # –ë–µ—Ä–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏
    txt = locations[position]['text']
    # –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ —Ç–µ—Ö –∏–ª–∏ –∏–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏–π
    if users_info[user]['shkatulka_taken'] and position == '6':
        txt = "–í—ã —É–∂–µ –ø–æ–¥–æ–±—Ä–∞–ª–∏ —à–∫–∞—Ç—É–ª–∫—É. –ë–æ–ª—å—à–µ –∑–¥–µ—Å—å –Ω–∏—á–µ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ –Ω–µ—Ç."
    if users_info[user]['items'] == ['—à–∫–∞—Ç—É–ª–∫–∞'] and position == '4':
        txt = '–í—ã –≤—ã—à–ª–∏ –Ω–∞ –ø–æ–ª–µ. –ü–µ—Ä–µ–¥ –≤–∞–º–∏ —Å—Ç–æ–∏—Ç —Ç–æ—Ä–≥–æ–≤–µ—Ü. –û–Ω –ø—Ä–µ–¥–ª–æ–∂–∏–ª –≤–∞–º 3 –∑–æ–ª–æ—Ç—ã—Ö –º–æ–Ω–µ—Ç –∑–∞ —à–∫–∞—Ç—É–ª–∫—É. –£ –≤–∞—Å –µ—Å—Ç—å —à–∫–∞—Ç—É–ª–∫–∞, –ø–æ—ç—Ç–æ–º—É –≤—ã —Å–æ–≥–ª–∞—Å–∏–ª–∏—Å—å.'
    if position == '4' and users_info[user]['shkatulka_given'] == True:
        txt = '–í—ã —É–∂–µ –æ–±–º–µ–Ω—è–ª–∏ —à–∫–∞—Ç—É–ª–∫—É —É —Ç–æ—Ä–≥–æ–≤—Ü–∞, –±–æ–ª—å—à–µ –µ–º—É –Ω–µ—á–µ–≥–æ –≤–∞–º –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å.'
    if position == '7' and users_info[user]['coins_taken'] == True:
        txt = '–°—Ç–µ–Ω—ã –∑–¥–µ—Å—å –∏–∑ –≥—Ä—É–±–æ–≥–æ –∫–∞–º–Ω—è –∏ –ø–æ–∫—Ä—ã—Ç—ã –º—Ö–æ–º –∏ –ø–ª–µ—Å–µ–Ω—å—é. –í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –∑–∞–ø–∞—Ö —Å—ã—Ä–æ—Å—Ç–∏ –∏ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞.\n–í—ã —É–∂–µ –ø–æ–¥–æ–±—Ä–∞–ª–∏ –ª–µ–∂–∞–≤—à–∏–µ –≤ —É–≥–ª—É –º–æ–Ω–µ—Ç—ã, —Ç–∞–∫ —á—Ç–æ –º–æ–∂–µ—Ç–µ –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ'
    # –°–æ–∑–¥–∞—ë–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    keyboard = telebot.types.InlineKeyboardMarkup()
    # c–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫–∏ —Å –≤–æ–∑–º–æ–¥–Ω—ã–º–∏ —Ö–æ–¥–∞–º–∏
    for i in users_info[user]['loc'][position]['next_move']:
        # –±–µ—Ä—ë–º —Ç–µ–∫—Å—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        key_text = i
        # –±–µ—Ä–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏
        key_data = locations[position]['next_move'][i]
        # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
        keyboard.add(telebot.types.InlineKeyboardButton(text=key_text, callback_data=key_data))
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –¥–ª—è –ø–æ–¥–±–∏—Ä–∞–Ω–∏—è –∏–ª–∏ –æ–±–º–µ–Ω–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
    if users_info[user]['loc'][users_info[user]['cur_pos']]['items'] and \
            users_info[user]['loc'][users_info[user]['cur_pos']]['items'] != ['–∑–æ–ª–æ—Ç–æ: 2'] and not users_info[user][
        'shkatulka_taken']:
        users_info[user]['items'] = users_info[user]['loc'][users_info[user]['cur_pos']]['items']
        users_info[user]['shkatulka_taken'] = True
    if users_info[user]['loc'][users_info[user]['cur_pos']]['items'] == ['–∑–æ–ª–æ—Ç–æ: 2']:
        users_info[user]['coins'] += int(users_info[user]['loc'][users_info[user]['cur_pos']]['items'][0][-1])
        users_info[user]['coins_taken'] = True
    if users_info[user]['loc'][users_info[user]['cur_pos']]['exchange'] and users_info[user]['items'] and \
            users_info[user]['cur_pos'] not in ['7', '8', '9']:
        users_info[user]['coins'] += int(
            users_info[user]['loc'][users_info[user]['cur_pos']]['exchange'][users_info[user]['items'][0]][-1])
        users_info[user]['shkatulka_given'] = True
    if users_info[user]['loc'][users_info[user]['cur_pos']]['exchange'] == {'–∑–æ–ª–æ—Ç–æ: 5': '–≤—ã—Ö–æ–¥'}:
        if users_info[user]['coins'] >= 5:
            bot.send_message(call.message.chat.id,
                             '–£ –≤–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥, —á—Ç–æ–±—ã –ø–æ–∫–∏–Ω—É—Ç—å —ç—Ç–æ –º–µ—Å—Ç–æ. –í—ã –Ω–∞–∫–æ–Ω–µ—Ü —Å–≤–æ–±–æ–¥–Ω—ã!')
            users_info[user]['good_endings'] += 1
            return None, None
    if users_info[user]['cur_pos'] == '3':
        users_info[user]['bad_endings'] += 1
    if users_info[user]['cur_pos'] == '6':
        users_info[user]['shkatulka_taken'] = True
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    return (txt, keyboard)


def start_game(message):
    # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ª–æ–≤–∞—Ä—å —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    users_info[message.from_user.username] = {'cur_pos': '1',
                                              'coins': 0,
                                              'items': [],
                                              'loc': deepcopy(locations),
                                              'bad_endings': 0,
                                              'good_endings': 0,
                                              'shkatulka_taken': False,
                                              'shkatulka_given': False,
                                              'coins_taken': False}
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É—Ä–æ–≤–µ–Ω—å –∏–≥—Ä—ã
    txt, keyboard = generate_story(message.from_user.username, users_info[message.from_user.username]['cur_pos'])
    bot.send_message(message.chat.id, txt, reply_markup=keyboard)


@bot.callback_query_handler(func=lambda call: call.data in locations)
def callback_query(call):
    # –º–µ–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    users_info[call.from_user.username]['cur_pos'] = call.data
    # –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç –∏ –∫–Ω–æ–ø–∫–∏
    txt, keyboard = generate_story(call.from_user.username, users_info[call.from_user.username]['cur_pos'], call=call)
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º–∏ –∫–Ω–æ–ø–∫–º–º–∏ –∏ —Ç–µ–∫—Å—Ç–æ–º
    if txt and keyboard:
        bot.send_message(call.message.chat.id, txt, reply_markup=keyboard)


# –§—É–Ω–∫—Ü–∏—è, –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–∞—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
def weather(message):
    keyboard = telebot.types.ReplyKeyboardMarkup(row_width=1, resize_keyboard=True)
    button_geo = telebot.types.KeyboardButton(text='–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º', request_location=True)
    keyboard.add(button_geo)
    bot.send_message(message.chat.id, '–ü–æ–¥–µ–ª–∏—Å—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º', reply_markup=keyboard)


@bot.message_handler(content_types=['location'])
def location(message):
    a = telebot.types.ReplyKeyboardRemove()
    bot.send_message(message.chat.id, current_weather(message.location.latitude, message.location.longitude),
                     reply_markup=a)
    keyboard = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True)
    button = telebot.types.KeyboardButton(text='–°—ã–≥—Ä–∞—Ç—å –≤ –∏–≥—Ä—É')
    button2 = telebot.types.KeyboardButton(text='–ü–æ–≥–æ–¥–∞ —É –º–µ–Ω—è')
    button3 = telebot.types.KeyboardButton(text='–°–ª—É—á–∞–π–Ω—ã–π –∞–Ω–µ–∫–¥–æ—ÇüòÜ')
    button4 = telebot.types.KeyboardButton(text='–°–ª—É—á–∞–π–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –∫–æ—Ç–∏–∫–∞')
    button5 = telebot.types.KeyboardButton(text='–°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ')
    button6 = telebot.types.KeyboardButton(text='–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä')
    button7 = telebot.types.KeyboardButton(text='–°—ã–≥—Ä–∞—Ç—å –≤ –∫–∞–º–µ–Ω—å –Ω–æ–∂–Ω–∏—Ü—ã –±—É–º–∞–≥–∞')
    button8 = telebot.types.KeyboardButton(text='–£—á–∏—Ç—å –∏–¥–∏–æ–º—ã')
    keyboard.add(button, button2, button3, button4, button5, button6, button7, button8)
    bot.send_message(message.chat.id, '–ù—É —á—Ç–æ, —á–µ–º –∑–∞–π–º—ë–º—Å—è —Ç–µ–ø–µ—Ä—å?', reply_markup=keyboard)


def send_joke(mess, theme):
    result = random.choice(joke[theme])
    bot.send_message(mess.message.chat.id, result)


def start_anek(message):
    bot.send_chat_action(message.chat.id, "typing", timeout=10)
    keyboard = telebot.types.InlineKeyboardMarkup()
    but1 = telebot.types.InlineKeyboardButton("–ü—Ä–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤", callback_data="programming")
    but2 = telebot.types.InlineKeyboardButton("–ü—Ä–æ –≥–µ–π–º–µ—Ä–æ–≤", callback_data='gamers')
    but3 = telebot.types.InlineKeyboardButton('–ü—Ä–æ –®—Ç—Ä–∏–ª–∏—Ü–∞üòÅ', callback_data='stirlitz')
    keyboard.add(but1, but2, but3)
    bot.send_message(message.chat.id, "–ê –Ω–∞ –∫–∞–∫—É—é —Ç–µ–º—É –∞–Ω–µ–∫–¥–æ—Ç-—Ç–æ?", reply_markup=keyboard)


@bot.callback_query_handler(func=lambda call: call.data in ['programming', 'gamers', 'stirlitz'])
def joke_callback(call):
    send_joke(call, call.data)


def send_rand_cat(message):
    r = requests.get('https://cataas.com/cat?json=true')
    try:
        url = 'https://cataas.com/cat/' + r.json()['_id']
        bot.send_photo(message.chat.id, url)
    except requests.exceptions.JSONDecodeError:
        bot.send_message(message.chat.id, '–£–ø—Å, –∏–∑–≤–∏–Ω–∏, –∫–∞–∂–µ—Ç—Å—è, –∫–∞–∫–∏–µ-—Ç–æ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–∞–π—Ç–æ–º. –Ø —Ç—É—Ç —Ç–æ—á–Ω–æ –Ω–∏ –ø—Ä–∏ —á—ë–ºüòá')


def send_cat_text(message):
    msg = bot.send_message(message.chat.id, '–ü—Ä–∏–¥—É–º–∞–π –ø–æ–¥–ø–∏—Å—å –∏ –Ω–∞–ø–∏—à–∏ –µ—ë –º–Ω–µ')
    bot.register_next_step_handler(msg, send_photo_text)


def send_photo_text(message):
    r = requests.get('https://cataas.com/cat/says/' + message.text + '?json=true')
    try:
        url = 'https://cataas.com/cat/' + r.json()['_id'] + f'/says/{message.text}'
        bot.send_photo(message.chat.id, url)
    except requests.exceptions.JSONDecodeError:
        bot.send_message(message.chat.id, '–£–ø—Å, –∏–∑–≤–∏–Ω–∏, –∫–∞–∂–µ—Ç—Å—è, –∫–∞–∫–∏–µ-—Ç–æ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–∞–π—Ç–æ–º. –Ø —Ç—É—Ç —Ç–æ—á–Ω–æ –Ω–∏ –ø—Ä–∏ —á—ë–ºüòá')


# –§—É–Ω–∫—Ü–∏—è, –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–∞—è —Ä–∞–Ω–¥–æ–º–Ω–æ–µ —á–∏—Å–ª–æ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ, –∑–∞–¥–∞–Ω–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
def random_num(message):
    try:
        a—Å, b—Å = int(message.text.split()[0]), int(message.text.split()[1])
    except ValueError:
        if not "–°–ª—É—á–∞–π" in message.text:
            bot.send_message(message.chat.id,
                             f'–ù—É, —Ä–∞–∑ —Ç—ã –Ω–µ —Ö–æ—á–µ—à—å –ø–æ —Å–≤–æ–µ–º—É, –±—É–¥–µ—Ç –ø–æ-–º–æ–µ–º—É! –ú–æ–µ —á–∏—Å–ª–æ:{random.choice([1337, 148480, 1552, 1234])}')
        else:
            bot.send_message(message.chat.id,
                             f'–ß—Ç–æ, –Ω–µ—É–∂–µ–ª–∏ —Ç–∞–∫ —Å–ª–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –¥–≤–∞ —á–∏—Å–ª–∞? –•–æ—Ä–æ—à–æ, –≤–æ—Ç —Ç–µ–±–µ –º–æ—ë —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ:{random.randint(0, 10 ** 10)}')
        return
    if b—Å > a—Å:
        bot.send_message(message.chat.id, f'–í–æ—Ç —Ç–µ–±–µ —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç {a—Å} –¥–æ {b—Å}: {random.randint(a—Å, b—Å)}')
    elif a—Å == b—Å:
        bot.send_message(message.chat.id,
                         '–ù—É –∏ –∑–∞—á–µ–º —Ç—ã –æ—Ç–ø—Ä–∞–≤–∏–ª –¥–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —á–∏—Å–ª–∞?üò° –î—É–º–∞–µ—à—å, —ç—Ç–æ —Å–º–µ—à–Ω–æ? –í–æ–≤—Å–µ –Ω–µ—Ç!')
    else:
        bot.send_message(message.chat.id,
                         f'–ê–≥–∞, —Ö–æ—Ç–µ–ª –ø–µ—Ä–µ—Ö–∏—Ç—Ä–∏—Ç—å –º–µ–Ω—è? –î—É–º–∞–ª, —á—Ç–æ —è —Å–ª–æ–º–∞—é—Å—å? –ê –≤–æ—Ç –∏ –Ω–µ—Ç! –ú–æ—ë —á–∏—Å–ª–æ –æ—Ç {b—Å} –¥–æ {a—Å}: {random.randint(b—Å, a—Å)}')


@bot.message_handler(content_types=['sticker'])
def get_sticker(message):
    bot.send_message(message.chat.id,
                     f'–ö–ª–∞—Å—Å–Ω—ã–π —Å—Ç–∏–∫–µ—Ä! –ö—Å—Ç–∞—Ç–∏, –∑–Ω–∞–µ—à—å –µ–≥–æ ID? –Ø –≤–æ—Ç –∑–Ω–∞—é. –í–æ—Ç –æ–Ω: {message.sticker.file_id}')


@bot.message_handler(commands=['help'])
def help(message):
    h_mes = ''
    for i in help_message:
        h_mes += i
    bot.send_message(message.chat.id, h_mes)


user_data = {}


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /reminder
def reminder_message(message):
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
    bot.send_message(message.chat.id,
                     '–ß—Ç–æ –∏–º–µ–Ω–Ω–æ —è –¥–æ–ª–∂–µ–Ω —Ç–µ–±–µ –Ω–∞–ø–æ–º–Ω–∏—Ç—å?: (/cancel_timer, –µ—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å –æ—Ç–º–µ–Ω–∏—Ç—å —Ç–∞–π–º–µ—Ä)')
    bot.register_next_step_handler(message, set_reminder_name)


# –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /reminder –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
def set_reminder_name(message):
    user_data[message.chat.id] = {'reminder_name': message.text}
    user_data[message.chat.id]['timer'] = []
    bot.send_message(message.chat.id,
                     '–ö–æ–≥–¥–∞ –Ω–∞–ø–æ–º–Ω–∏—Ç—å? –í–≤–µ–¥–∏ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ì–ì–ì–ì-–ú–ú-–î–î —á—á:–º–º:—Å—Å.')
    bot.register_next_step_handler(message, reminder_set, user_data)


# –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /reminder –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
def reminder_set(message, user_data):
    try:
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤–≤–µ–¥–µ–Ω–Ω—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç datetime
        reminder_time = datetime.datetime.strptime(message.text, '%Y-%m-%d %H:%M:%S')
        now = datetime.datetime.now()
        delta = reminder_time - now
        # –ï—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —É–∂–µ –ø—Ä–æ—à–ª–∏, –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        if delta.total_seconds() <= 0:
            bot.send_message(message.chat.id, '–Ø –Ω–µ –º–∞—à–∏–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏, –ø–æ—Å—Ç–∞–≤—å –¥–∞—Ç—É, –∫–æ—Ç–æ—Ä–∞—è –µ—à—ë –Ω–µ –ø—Ä–æ—à–ª–∞')
            bot.register_next_step_handler(message, reminder_set, user_data)
        # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–µ–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
        else:
            reminder_name = user_data[message.chat.id]['reminder_name']
            bot.send_message(message.chat.id,
                             '–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ "{}" —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ {}.'.format(reminder_name, reminder_time))
            reminder_timer = threading.Timer(delta.total_seconds(), send_reminder, [message.chat.id, reminder_name])
            reminder_timer.start()
            user_data[message.chat.id]['timer'].append(reminder_timer)
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–µ–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è, –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    except ValueError:
        bot.send_message(message.chat.id, '–û—à–∏–±–∫–∞! –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏, –ø–æ–ø—Ä–æ–±—É–π-–∫–∞ –µ—â–µ —Ä–∞–∑.')
        bot.register_next_step_handler(message, reminder_set, user_data)


# –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
def send_reminder(chat_id, reminder_name):
    bot.send_message(chat_id, f'–í—Ä–µ–º—è –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ "{reminder_name}"!')


def idioms(message):
    bot.send_message(message.chat.id,
                     '–ê–≥–∞! –ù–µ—É–∂–µ–ª–∏ –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ –∑–∞ –≥–æ–ª–æ–≤—É –≤–∑—è–ª—Å—è? –ù—É —Ö–æ—Ä–æ—à–æ, —Å–µ–π—á–∞—Å –º—ã —Å —Ç–æ–±–æ–π –ø–æ—É—á–∏–º –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –∏–¥–∏–æ–º—ã.')
    for i in range(3, SKOLKO_IDIOM + 1, 3):
        stroka = ''
        idis = [IDIOMS_LIST[i - 3], IDIOMS_LIST[i - 2], IDIOMS_LIST[i - 1]]
        exes = [EXAMPLES_LIST[i - 3], EXAMPLES_LIST[i - 2], EXAMPLES_LIST[i - 1]]
        for y in range(len(idis)):
            stroka += f'{idis[y]} \n–ü—Ä–∏–º–µ—Ä: {exes[y]} \n \n'
        bot.send_message(message.chat.id, stroka)
    bot.send_message(message.chat.id, '–ù—É, –∫–∞–∫-—Ç–æ —Ç–∞–∫üôÉ. –¢–µ–ø–µ—Ä—å –¥–µ–ª–æ –∑–∞ —Ç–æ–±–æ–π.')

def english_test(message):
    global chosen_quest, r_ans
    a = list(test.keys())
    b = list(test.values())
    n_idim = random.choice(a)
    chosen_quest = n_idim
    r_ans = test[n_idim]
    w1_ans = random.choice(b)
    w2_ans = random.choice(b)
    while not(r_ans != w1_ans and r_ans != w2_ans and w1_ans != w2_ans):
        w1_ans = random.choice(b)
        w2_ans = random.choice(b)
    keybord = telebot.types.InlineKeyboardMarkup()
    button = telebot.types.InlineKeyboardButton(text=w1_ans, callback_data=w1_ans)
    button2 = telebot.types.InlineKeyboardButton(text=r_ans, callback_data=r_ans)
    button3 = telebot.types.InlineKeyboardButton(text=w2_ans, callback_data=w2_ans)
    sp = [button, button2, button3]
    random.shuffle(sp)
    for i in sp:
        keybord.add(i)
    bot.send_message(message.chat.id, f'–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–µ—Ä–µ–≤–æ–¥–∞ –∏–¥–∏–æ–º—ã: {n_idim}', reply_markup=keybord)

@bot.callback_query_handler(func=lambda call: call.data in test.values())
def check_ans(call):
    global chosen_quest
    if list(test.keys()).index(chosen_quest) == list(test.values()).index(call.data):
        bot.send_message(call.message.chat.id, '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!')
    else:
        bot.send_message(call.message.chat.id, f'–ù–µ–≤–µ—Ä–Ω–æ! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:{r_ans}')
    english_test(call.message)


@bot.message_handler(commands=['start'])
def start(message):
    bot.send_message(message.chat.id, '–ó–¥—Ä–∞—Å—Ç–≤—É–π! –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, —Ç—ã –Ω–µ –æ–±—â–∞–ª—Å—è —Å–æ –º–Ω–æ–π —Ä–∞–Ω–µ–µ, –µ—Å–ª–∏ —É–∂ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –ø–æ—ç—Ç–æ–º—É - —Ä–∞–¥ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è! –ò –∫—Å—Ç–∞—Ç–∏, —è –ª—é–±–ª—é, –∫–æ–≥–¥–∞ —Å–æ –º–Ω–æ–π –∑–¥–æ—Ä–æ–≤–∞—é—Ç—Å—è, –∫–∞–∫ —Å —á–µ–ª–æ–≤–µ–∫–æ–º, –∞ —Å –±–æ—Ç–æ–ºüòâ')


@bot.message_handler(commands=['cancel_timer'])
def cancel_timer(message):
    for i in range(len(user_data[message.chat.id]['timer'])):
        timer = user_data[message.chat.id]['timer'][i]
        timer.cancel()
    bot.send_message(message.chat.id, '–¢–∞–π–º–µ—Ä –±—ã–ª —É—Å–ø–µ—à–Ω–æ —Å–±—Ä–æ—à–µ–Ω. –ú–æ–∂–µ—à—å –Ω–µ –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç—åüòé')


# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã –≤ –∫–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞
def play_rps(message):
    bot_mes = {'–∫–∞–º–µ–Ω—å': "–∫–∞–º–µ–Ω—å", "–Ω–æ–∂–Ω–∏—Ü—ã": "–Ω–æ–∂–Ω–∏—Ü—ã", "–±—É–º–∞–≥–∞": "–±—É–º–∞–≥—É"}
    keyboard = telebot.types.InlineKeyboardMarkup()
    but1 = telebot.types.InlineKeyboardButton('–ö–∞–º–µ–Ω—å', callback_data='–ö–∞–º–µ–Ω—å')
    but2 = telebot.types.InlineKeyboardButton('–ù–æ–∂–Ω–∏—Ü—ã', callback_data='–ù–æ–∂–Ω–∏—Ü—ã')
    but3 = telebot.types.InlineKeyboardButton('–ë—É–º–∞–≥–∞', callback_data='–ë—É–º–∞–≥–∞')
    keyboard.add(but1, but2, but3)
    bot.send_message(message.chat.id, '–¢–∞–∫ —á—Ç–æ –∂–µ —Ç—ã –≤—ã–±–µ—Ä–µ—à—å?', reply_markup=keyboard)


@bot.message_handler(content_types=['text'])
def starting_message(message):
    global game_started
    sad_flag = False
    said_hello = False
    said_goodbye = False
    but_pressed = False
    timer_set = False
    rps_play_started = False
    thanks_said = False
    idioms_started = False
    if '–ø—Ä–∏–≤–µ—Ç' in message.text or '–ü—Ä–∏–≤–µ—Ç' in message.text:
        if not said_hello:
            said_hello = True
            keyboard = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True)
            button = telebot.types.KeyboardButton(text='–°—ã–≥—Ä–∞—Ç—å –≤ –∏–≥—Ä—É')
            button2 = telebot.types.KeyboardButton(text='–ü–æ–≥–æ–¥–∞ —É –º–µ–Ω—è')
            button3 = telebot.types.KeyboardButton(text='–°–ª—É—á–∞–π–Ω—ã–π –∞–Ω–µ–∫–¥–æ—ÇüòÜ')
            button4 = telebot.types.KeyboardButton(text='–°–ª—É—á–∞–π–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –∫–æ—Ç–∏–∫–∞')
            button5 = telebot.types.KeyboardButton(text='–°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ')
            button6 = telebot.types.KeyboardButton(text='–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä')
            button7 = telebot.types.KeyboardButton(text='–°—ã–≥—Ä–∞—Ç—å –≤ –∫–∞–º–µ–Ω—å –Ω–æ–∂–Ω–∏—Ü—ã –±—É–º–∞–≥–∞')
            button8 = telebot.types.KeyboardButton(text='–£—á–∏—Ç—å –∏–¥–∏–æ–º—ã')
            keyboard.add(button, button2, button3, button4, button5, button6, button7, button8)
            bot.send_message(message.chat.id,
                             '–ò —Ç–µ–±–µ –ø—Ä–∏–≤–µ—Ç!üôãüèª‚Äç‚ôÇÔ∏è –°–º–æ—Ç—Ä–∏, —á—Ç–æ —è —É–º–µ—é.\n–ö—Å—Ç–∞—Ç–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å, –ø—Ä–æ–ø–∏—à–∏ –∫–æ–º–∞–Ω–¥—É /help, –∏ —è —Ç–µ–±–µ –≤—Å—ë —Ä–∞—Å—Å–∫–∞–∂—É.',
                             reply_markup=keyboard)
        else:
            bot.send_message(message.chat.id, '–ü–æ–∑–¥–æ—Ä–≤–∞–ª–∏—Å—å —É–∂–µüòë')
    elif '–ø–æ–∫–∞' in message.text or "–ü–æ–∫–∞" in message.text:
        said_goodbye = True
        a = telebot.types.ReplyKeyboardRemove()
        bot.send_message(message.chat.id, "–ü–æ–∫–∞-–ø–æ–∫–∞! –ñ–¥—É —Ç–µ–±—è —Å–Ω–æ–≤–∞!",
                         reply_markup=a)
    elif '–°—ã–≥—Ä–∞—Ç—å –≤ –∏–≥—Ä—É' in message.text:
        but_pressed = True
        game_started = True
        start_game(message)
    elif '–ü–æ–≥–æ–¥–∞ —É –º–µ–Ω—è' in message.text:
        but_pressed = True
        weather(message)
    elif '–°–ª—É—á–∞–π–Ω—ã–π –∞–Ω–µ–∫–¥–æ—ÇüòÜ' in message.text:
        but_pressed = True
        start_anek(message)
    elif '–°–ª—É—á–∞–π–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –∫–æ—Ç–∏–∫–∞' in message.text:
        but_pressed = True
        keyboard52 = telebot.types.InlineKeyboardMarkup()
        but1 = telebot.types.InlineKeyboardButton("–° –ø–æ–¥–ø–∏—Å—å—é", callback_data="–ø–æ–¥–ø–∏—Å—å")
        but2 = telebot.types.InlineKeyboardButton("–ë–µ–∑ –ø–æ–¥–ø–∏—Å–∏", callback_data='–±–µ–∑ –ø–æ–¥–ø–∏—Å–∏')
        keyboard52.add(but1, but2)
        bot.send_message(message.chat.id, "–° –ø–æ–¥–ø–∏—Å—å—é –∏–ª–∏ –±–µ–∑?", reply_markup=keyboard52)
    elif '–°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ' in message.text:
        but_pressed = True
        msg = bot.send_message(message.chat.id, "–û—Ç –∫–∞–∫–æ–≥–æ —á–∏—Å–ª–∞ –¥–æ –∫–∞–∫–æ–≥–æ? –ù–∞–ø–∏—à–∏ 2 —á–∏—Å–ª–∞")
        bot.register_next_step_handler(msg, random_num)
    elif '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä' in message.text:
        timer_set = True
        reminder_message(message)
    elif '–°—ã–≥—Ä–∞—Ç—å –≤ –∫–∞–º–µ–Ω—å –Ω–æ–∂–Ω–∏—Ü—ã –±—É–º–∞–≥–∞' in message.text:
        play_rps(message)
        rps_play_started = True
    elif '–£—á–∏—Ç—å –∏–¥–∏–æ–º—ã' in message.text:
        idioms_started = True
        keyboard52 = telebot.types.InlineKeyboardMarkup()
        but1 = telebot.types.InlineKeyboardButton("–•–æ—á—É –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç", callback_data="–¢–µ—Å—Ç")
        but2 = telebot.types.InlineKeyboardButton("–•–æ—á—É –ø–æ–¥—É—á–∏—Ç—å –∏–¥–∏–æ–º—ã", callback_data='–û–±—É—á–µ–Ω–∏–µ')
        keyboard52.add(but1, but2)
        bot.send_message(message.chat.id, "–•–æ—á–µ—à—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è –∏–¥–∏–æ–º? –ò–ª–∏ —É–ª—É—á—à–∏—Ç—å –∏—Ö?", reply_markup=keyboard52)

    elif '–°–ø–∞—Å–∏–±–æ' in message.text or '—Å–ø–∞—Å–∏–±–æ' in message.text:
        bot.send_sticker(message.chat.id, 'CAACAgIAAxkBAAICimYqRDIIn2dIw2mPuREwakyk3-F0AAJUAQACe04qEHOJG1Z2_0xWNAQ')
        bot.send_message(message.chat.id, '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞')
        thanks_said = True
    for i in message.text.split():
        if i in sad_words and (
                '–Ø' in message.text or '—è' in message.text or '–ú–Ω–µ' in message.text or '–º–Ω–µ' in message.text):
            s_mes = ''
            for i in sad_caption:
                s_mes += i
            bot.send_message(message.chat.id, s_mes)
            sad_flag = True
    else:
        if (not sad_flag and not said_hello and not said_goodbye
                and not but_pressed and not timer_set and not rps_play_started and not thanks_said and not idioms_started):
            bot.send_message(message.chat.id,
                             '–ù–µ –ø–æ–Ω—è–ª, —á—Ç–æ —Ç—ã –∏–º–µ–µ—à—å –≤–≤–∏–¥—Éüò∂‚Äçüå´Ô∏è\n–õ—É—á—à–µ –Ω–∞–ø–∏—à–∏ "–ø—Ä–∏–≤–µ—Ç", —ç—Ç–æ —Å–ª–æ–≤–æ —è –ø–æ–Ω–∏–º–∞—é')


@bot.callback_query_handler(func=lambda call: call.data == "–ø–æ–¥–ø–∏—Å—å" or call.data == '–±–µ–∑ –ø–æ–¥–ø–∏—Å–∏')
def cat_photo(call):
    if call.data == "–ø–æ–¥–ø–∏—Å—å":
        send_cat_text(call.message)
    elif call.data == '–±–µ–∑ –ø–æ–¥–ø–∏—Å–∏':
        send_rand_cat(call.message)

@bot.callback_query_handler(func=lambda call: call.data == "–¢–µ—Å—Ç" or call.data == '–û–±—É—á–µ–Ω–∏–µ')
def english(call):
    if call.data == '–û–±—É—á–µ–Ω–∏–µ':
        idioms(call.message)
    else:
        bot.send_message(call.message.chat.id, '–û—Ç–ª–∏—á–Ω–æ! –ü—Ä–∏–≥–æ—Ç–æ–≤—å—Å—è –ø–æ–∫–∞–∑–∞—Ç—å –º–Ω–µ –≤—Å—ë, —á—Ç–æ –∑–Ω–∞–µ—à—å!')
        english_test(call.message)


@bot.callback_query_handler(func=lambda call: call.data in ["–ö–∞–º–µ–Ω—å", "–ù–æ–∂–Ω–∏—Ü—ã", "–ë—É–º–∞–≥–∞"])
def rps_decider(call):
    bot_mes = {'–ö–∞–º–µ–Ω—å': "–ö–∞–º–µ–Ω—å", "–ù–æ–∂–Ω–∏—Ü—ã": "–ù–æ–∂–Ω–∏—Ü—ã", "–ë—É–º–∞–≥–∞": "–ë—É–º–∞–≥—É"}
    user_choice = call.data
    bot_choice = random.choice(['–ö–∞–º–µ–Ω—å', '–ù–æ–∂–Ω–∏—Ü—ã', '–ë—É–º–∞–≥–∞'])
    if user_choice == bot_choice:
        bot.send_message(call.message.chat.id, f"–ù–∏—á—å—è! –Ø –≤—ã–±—Ä–∞–ª {bot_mes[bot_choice]}.")
    elif (user_choice == '–ö–∞–º–µ–Ω—å' and bot_choice == '–ù–æ–∂–Ω–∏—Ü—ã') or (
            user_choice == '–ù–æ–∂–Ω–∏—Ü—ã' and bot_choice == '–ë—É–º–∞–≥–∞') or (
            user_choice == '–ë—É–º–∞–≥–∞' and bot_choice == '–ö–∞–º–µ–Ω—å'):
        bot.send_message(call.message.chat.id, f"–¢—ã –ø–æ–±–µ–¥–∏–ª! –Ø –≤—ã–±—Ä–∞–ª {bot_mes[bot_choice]}.")
    else:
        bot.send_message(call.message.chat.id, f"–Ø –ø–æ–±–µ–¥–∏–ª! –Ø –≤—ã–±—Ä–∞–ª {bot_mes[bot_choice]}.")


if __name__ == "__main__":
    bot.infinity_polling()  # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç, –∏–Ω–∞—á–µ –±–æ—Ç –±—É–¥–µ—Ç –º–æ–ª—á–∞—Ç—å
